## 特定の送信先ドメイン（またはメールアドレス）へのメールを制限する

#### 1. 設定値

```bash
smtpd_recipient_restrictions = check_recipient_access hash:/etc/postfix/reject_receiver
```

#### 2. 手順

##### 2-1. 以下のコマンドを実行し、設定を追加する

```bash
### smtp-relay
$ touch /etc/postfix/reject_receiver
$ postmap /etc/postfix/reject_receiver

$ postconf -e 'smtpd_recipient_restrictions = check_recipient_access hash:/etc/postfix/reject_receiver'

$ systemctl reload postfix
```

```bash
$ echo "example.co.jp    reject" >>/etc/postfix/reject_receiver
$ echo ".example.co.jp    reject" >>/etc/postfix/reject_receiver

$ postmap /etc/postfix/reject_receiver
```

##### 2-2. 以下のコマンドを実行し、テストメールを送信する

```bash
### smtp-client
$ echo "Hello World" | mailx -s "subject" -S from='from_user@example.net' 'to_user@example.co.jp'
```

##### 2-3. メールログを確認する

```bash
### smtp-relay
Apr 29 09:16:00 smtp-relay postfix/smtpd[26305]: connect from smtp-client.example.com[192.168.10.22]
Apr 29 09:16:00 smtp-relay postfix/smtpd[26305]: NOQUEUE: reject: RCPT from smtp-client.example.com[192.168.10.22]: 554 5.7.1 <to_user@example.co.jp>: Recipient address rejected: Access denied; from=<from_user@example.net> to=<to_user@example.co.jp> proto=ESMTP helo=<smtp-client.example.com>
Apr 29 09:16:00 smtp-relay postfix/smtpd[26305]: disconnect from smtp-client.example.com[192.168.10.22]
```

```bash
### smtp-client
Apr 29 09:27:35 localhost postfix/pickup[11892]: 70D0DCB72D: uid=1005 from=<from_user>
Apr 29 09:27:35 localhost postfix/cleanup[11946]: 70D0DCB72D: message-id=<608a7c07.z6PRwrI0l9ozlgNf%from_user@example.net>
Apr 29 09:27:35 localhost postfix/qmgr[11893]: 70D0DCB72D: from=<from_user@example.net>, size=448, nrcpt=1 (queue active)
Apr 29 09:27:35 localhost postfix/smtp[11948]: 70D0DCB72D: to=<to_user@example.co.jp>, relay=192.168.10.21[192.168.10.21]:25, delay=0.07, delays=0.03/0.01/0.02/0.02, dsn=5.7.1, status=bounced (host 192.168.10.21[192.168.10.21] said: 554 5.7.1 <to_user@example.co.jp>: Recipient address rejected: Access denied (in reply to RCPT TO command))
Apr 29 09:27:35 localhost postfix/cleanup[11946]: 7CAFCCB72E: message-id=<20210429092735.7CAFCCB72E@smtp-client.example.com>
Apr 29 09:27:35 localhost postfix/qmgr[11893]: 7CAFCCB72E: from=<>, size=2460, nrcpt=1 (queue active)
Apr 29 09:27:35 localhost postfix/bounce[11949]: 70D0DCB72D: sender non-delivery notification: 7CAFCCB72E
Apr 29 09:27:35 localhost postfix/qmgr[11893]: 70D0DCB72D: removed
Apr 29 09:27:35 localhost postfix/local[11950]: 7CAFCCB72E: to=<from_user@example.net>, relay=local, delay=0.01, delays=0/0.01/0/0, dsn=2.0.0, status=sent (delivered to maildir)
Apr 29 09:27:35 localhost postfix/qmgr[11893]: 7CAFCCB72E: removed
```
