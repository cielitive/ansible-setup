## 特定の送信先ドメイン（またはメールアドレス）へのメールのルーティングを変更する

#### 1. 設定値

```bash
transport_maps = hash:/etc/postfix/transport
```

#### 2. 手順

##### 2-1. 以下のコマンドを実行し、設定を追加する

```bash
### node01
$ touch /etc/postfix/transport
$ postmap /etc/postfix/transport

$ postconf -e 'transport_maps = hash:/etc/postfix/transport'

$ systemctl reload postfix
```

```bash
$ echo "example.co.jp            smtp:192.168.10.20:25" >>/etc/postfix/transport

$ postmap /etc/postfix/transport
```

##### 2-2. 以下のコマンドを実行し、テストメールを送信する

```bash
### smtp-client
$ echo "Hello World" | mailx -s "subject" -S from='from_user@example.net' 'to_user@example.co.jp'
```

##### 2-3. メールログを確認する

```bash
### smtp-main
Apr 29 09:51:23 localhost postfix/smtpd[11836]: connect from smtp-relay.example.com[192.168.10.21]
Apr 29 09:51:23 localhost postfix/smtpd[11836]: 8F3C6835E8: client=smtp-relay.example.com[192.168.10.21]
Apr 29 09:51:23 localhost postfix/cleanup[11839]: 8F3C6835E8: message-id=<608a83b9.MEVDEBmmvxHB/BDS%from_user@example.net>
Apr 29 09:51:23 localhost postfix/qmgr[11722]: 8F3C6835E8: from=<from_user@example.net>, size=874, nrcpt=1 (queue active)
Apr 29 09:51:23 localhost postfix/smtpd[11836]: disconnect from smtp-relay.example.com[192.168.10.21]
Apr 29 09:51:23 localhost postfix/local[11840]: 8F3C6835E8: to=<to_user@example.co.jp>, relay=local, delay=0.06, delays=0.05/0.01/0/0, dsn=2.0.0, status=sent (delivered to maildir)
Apr 29 09:51:23 localhost postfix/qmgr[11722]: 8F3C6835E8: removed
```

```bash
### smtp-relay
Apr 29 09:51:34 smtp-relay postfix/smtpd[32755]: connect from smtp-client.example.com[192.168.10.22]
Apr 29 09:51:34 smtp-relay postfix/smtpd[32755]: 1607E1892F9: client=smtp-client.example.com[192.168.10.22]
Apr 29 09:51:34 smtp-relay postfix/cleanup[32758]: 1607E1892F9: message-id=<608a83b9.MEVDEBmmvxHB/BDS%from_user@example.net>
Apr 29 09:51:34 smtp-relay postfix/smtpd[32755]: disconnect from smtp-client.example.com[192.168.10.22]
Apr 29 09:51:34 smtp-relay postfix/qmgr[32752]: 1607E1892F9: from=<from_user@example.net>, size=663, nrcpt=1 (queue active)
Apr 29 09:51:34 smtp-relay postfix/smtp[32759]: 1607E1892F9: to=<to_user@example.co.jp>, relay=192.168.10.20[192.168.10.20]:25, delay=0.12, delays=0.03/0.01/0.02/0.06, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as 8F3C6835E8)
Apr 29 09:51:34 smtp-relay postfix/qmgr[32752]: 1607E1892F9: removed
```

```bash
### smtp-client
Apr 29 10:00:25 localhost postfix/pickup[11892]: 4AAC3CB72D: uid=1005 from=<from_user>
Apr 29 10:00:25 localhost postfix/cleanup[12024]: 4AAC3CB72D: message-id=<608a83b9.MEVDEBmmvxHB/BDS%from_user@example.net>
Apr 29 10:00:25 localhost postfix/qmgr[11893]: 4AAC3CB72D: from=<from_user@example.net>, size=448, nrcpt=1 (queue active)
Apr 29 10:00:25 localhost postfix/smtp[12026]: 4AAC3CB72D: to=<to_user@example.co.jp>, relay=192.168.10.21[192.168.10.21]:25, delay=0.12, delays=0.06/0.01/0.02/0.04, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as 1607E1892F9)
Apr 29 10:00:25 localhost postfix/qmgr[11893]: 4AAC3CB72D: removed
```
