## 特定の送信元ドメイン（またはメールアドレス）からのメールのルーティングを変更する

#### 1. 設定値

```bash
sender_dependent_default_transport_maps = hash:/etc/postfix/sender_transport
```

#### 2. 手順

##### 2-1. 以下のコマンドを実行し、設定を追加する

```bash
### smtp-relay
$ touch /etc/postfix/sender_transport
$ postmap /etc/postfix/sender_transport

$ postconf -e 'sender_dependent_default_transport_maps = hash:/etc/postfix/sender_transport'

$ systemctl reload postfix
```

```bash
$ echo "@example.jp    smtp:192.168.10.20:25" >/etc/postfix/sender_transport

$ postmap /etc/postfix/sender_transport
```

##### 2-2. 以下のコマンドを実行し、テストメールを送信する

```bash
### smtp-client
$ echo "Hello World" | mailx -s "subject" -S from='from_user@example.jp' 'to_user@example.net'
```

##### 2-3. メールログを確認する

```bash
### smtp-main
Apr 29 03:29:32 localhost postfix/smtpd[11812]: connect from smtp-relay.example.com[192.168.10.21]
Apr 29 03:29:32 localhost postfix/smtpd[11812]: BB219142C2C: client=smtp-relay.example.com[192.168.10.21]
Apr 29 03:29:32 localhost postfix/cleanup[11815]: BB219142C2C: message-id=<608a281c.EmRVK5ALLASEPJsY%from_user@example.jp>
Apr 29 03:29:32 localhost postfix/smtpd[11812]: disconnect from smtp-relay.example.com[192.168.10.21]
Apr 29 03:29:32 localhost postfix/qmgr[7568]: BB219142C2C: from=<from_user@example.jp>, size=867, nrcpt=1 (queue active)
Apr 29 03:29:32 localhost postfix/local[11816]: BB219142C2C: to=<to_user@example.net>, relay=local, delay=0.06, delays=0.05/0.01/0/0, dsn=2.0.0, status=sent (delivered to maildir)
Apr 29 03:29:32 localhost postfix/qmgr[7568]: BB219142C2C: removed
```

```bash
### smtp-relay
Apr 29 03:29:32 smtp-relay postfix/smtpd[1910]: connect from smtp-client.example.com[192.168.10.22]
Apr 29 03:29:32 smtp-relay postfix/smtpd[1910]: A8F6E17BD59: client=smtp-client.example.com[192.168.10.22]
Apr 29 03:29:32 smtp-relay postfix/cleanup[1913]: A8F6E17BD59: message-id=<608a281c.EmRVK5ALLASEPJsY%from_user@example.jp>
Apr 29 03:29:32 smtp-relay postfix/smtpd[1910]: disconnect from smtp-client.example.com[192.168.10.22]
Apr 29 03:29:32 smtp-relay postfix/qmgr[1907]: A8F6E17BD59: from=<from_user@example.jp>, size=657, nrcpt=1 (queue active)
Apr 29 03:29:32 smtp-relay postfix/smtp[1914]: A8F6E17BD59: to=<to_user@example.net>, relay=192.168.10.20[192.168.10.20]:25, delay=0.13, delays=0.04/0.01/0.02/0.05, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as BB219142C2C)
Apr 29 03:29:32 smtp-relay postfix/qmgr[1907]: A8F6E17BD59: removed
```

```bash
### smtp-client
Apr 29 03:29:32 localhost postfix/pickup[12902]: 9A1527892E: uid=1005 from=<from_user>
Apr 29 03:29:32 localhost postfix/cleanup[12997]: 9A1527892E: message-id=<608a281c.EmRVK5ALLASEPJsY%from_user@example.jp>
Apr 29 03:29:32 localhost postfix/qmgr[12310]: 9A1527892E: from=<from_user@example.jp>, size=444, nrcpt=1 (queue active)
Apr 29 03:29:32 localhost postfix/smtp[12999]: 9A1527892E: to=<to_user@example.net>, relay=192.168.10.21[192.168.10.21]:25, delay=0.13, delays=0.05/0.01/0.02/0.05, dsn=2.0.0, status=sent (250 2.0.0 Ok: queued as A8F6E17BD59)
Apr 29 03:29:32 localhost postfix/qmgr[12310]: 9A1527892E: removed
```
