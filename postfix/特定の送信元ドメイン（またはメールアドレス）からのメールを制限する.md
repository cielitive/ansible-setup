## 特定の送信元ドメイン（またはメールアドレス）からのメールを制限する

#### 1. 設定値

```bash
smtpd_sender_restrictions = check_sender_access hash:/etc/postfix/reject_sender
```

#### 2. 手順

##### 2-1. 以下のコマンドを実行し、設定を追加する

```bash
### smtp-relay
$ touch /etc/postfix/reject_sender
$ postmap /etc/postfix/reject_sender

$ postconf -e 'smtpd_sender_restrictions = check_sender_access hash:/etc/postfix/reject_sender'

$ systemctl reload postfix
```

```bash
$ echo "example.net    reject" >>/etc/postfix/reject_sender
$ echo ".example.net    reject" >>/etc/postfix/reject_sender

$ postmap /etc/postfix/reject_sender
```

##### 2-2. 以下のコマンドを実行し、テストメールを送信する

```bash
### smtp-client
$ echo "Hello World" | mailx -s "subject" -S from='from_user@example.jp' 'to_user@exmaple.com'
```

##### 2-3. メールログを確認する

```bash
### smtp-relay
Apr 29 09:11:37 smtp-relay postfix/smtpd[26252]: connect from smtp-client.example.com[192.168.10.22]
Apr 29 09:11:37 smtp-relay postfix/smtpd[26252]: NOQUEUE: reject: RCPT from smtp-client.example.com[192.168.10.22]: 554 5.7.1 <from_user@example.net>: Sender address rejected: Access denied; from=<from_user@example.net> to=<to_user@example.co.jp> proto=ESMTP helo=<smtp-client.example.com>
Apr 29 09:11:37 smtp-relay postfix/smtpd[26252]: disconnect from smtp-client.example.com[192.168.10.22]
```

```bash
### smtp-client
Apr 29 09:23:32 localhost postfix/pickup[11892]: 77783CB72D: uid=1005 from=<from_user>
Apr 29 09:23:32 localhost postfix/cleanup[11921]: 77783CB72D: message-id=<608a7b14.fxHA3TtqH+83Oeoi%from_user@example.net>
Apr 29 09:23:32 localhost postfix/qmgr[11893]: 77783CB72D: from=<from_user@example.net>, size=448, nrcpt=1 (queue active)
Apr 29 09:23:32 localhost postfix/smtp[11923]: 77783CB72D: to=<to_user@example.co.jp>, relay=192.168.10.21[192.168.10.21]:25, delay=0.3, delays=0.26/0/0.02/0.02, dsn=5.7.1, status=bounced (host 192.168.10.21[192.168.10.21] said: 554 5.7.1 <from_user@example.net>: Sender address rejected: Access denied (in reply to RCPT TO command))
Apr 29 09:23:32 localhost postfix/cleanup[11921]: A8FE0CB72E: message-id=<20210429092332.A8FE0CB72E@smtp-client.example.com>
Apr 29 09:23:32 localhost postfix/qmgr[11893]: A8FE0CB72E: from=<>, size=2454, nrcpt=1 (queue active)
Apr 29 09:23:32 localhost postfix/bounce[11928]: 77783CB72D: sender non-delivery notification: A8FE0CB72E
Apr 29 09:23:32 localhost postfix/qmgr[11893]: 77783CB72D: removed
Apr 29 09:23:32 localhost postfix/local[11929]: A8FE0CB72E: to=<from_user@example.net>, relay=local, delay=0.02, delays=0/0.01/0/0, dsn=2.0.0, status=sent (delivered to maildir)
Apr 29 09:23:32 localhost postfix/qmgr[11893]: A8FE0CB72E: removed
```
